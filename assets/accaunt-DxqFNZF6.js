var y=o=>{throw TypeError(o)};var _=(o,t,e)=>t.has(o)||y("Cannot "+e);var s=(o,t,e)=>(_(o,t,"read from private field"),e?e.call(o):t.get(o)),c=(o,t,e)=>t.has(o)?y("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(o):t.set(o,e),w=(o,t,e,n)=>(_(o,t,"write to private field"),n?n.call(o,e):t.set(o,e),e),S=(o,t,e)=>(_(o,t,"access private method"),e);import{a as H,H as N,M as P,S as T,b as $}from"./SwitchPageController-LEnDeDHD.js";import{C as J}from"./CityController-DSj6KMa1.js";var d,u,b;class M{constructor(t){c(this,u);c(this,d,"/pages/product.html?id=");this.loginBlockElement=document.querySelector(t.loginBlock),this.inputLoginElement=document.querySelector(t.inputLogin),this.buttonLoginElement=document.querySelector(t.buttonLogin),this.listBuyElement=document.querySelector(t.listBuy),this.profileBlockElement=document.querySelector(t.profileBlock),this.profileListElement=document.querySelector(t.profileList),this.logoutButtonElement=document.querySelector(t.logoutButton),this.notorderElement=document.querySelector(t.notorder),this.htmlBuilder=new H}loginUser(){const t=S(this,u,b).call(this,this.inputLoginElement.value);t&&(localStorage.setItem("login",t),location.reload())}hideUserLogin(){localStorage.getItem("login")&&(this.profileBlockElement.style.display="block",this.loginBlockElement.style.display="none")}logout(){this.logoutButtonElement.addEventListener("click",()=>{confirm("Вы точно хотите выйти?")&&(localStorage.removeItem("login"),location.reload())})}generateOrder(t){const e=JSON.parse(localStorage.getItem("orders"));if(e&&e.length){this.notorderElement.style.display="none";const n=this.htmlBuilder.createListItem("main-account__orders-table","",""),i=this.htmlBuilder.createBlock("main-account__orders-header");i.innerHTML=`
                <div class="main-account__orders-cell">Наименование товаров</div>
                <div class="main-account__orders-cell">Общая цена</div>
                <div class="main-account__orders-cell">Количество</div>
                <div class="main-account__orders-cell">Действие</div>
            `,n.appendChild(i),e.forEach(m=>{const p=m[0],q=m[1],I=m[2],l=this.htmlBuilder.createBlock("main-account__orders-row"),f=this.htmlBuilder.createBlock("main-account__orders-cell"),g=this.htmlBuilder.createBlock("main-account__products-list");p.forEach((v,O)=>{const B=t.find(r=>r.id==v);if(B){const r=this.htmlBuilder.createBlock("main-account__name-block"),U=this.htmlBuilder.createImage(B.mainImage,"main-account__image"),A=this.htmlBuilder.createNameLinkProduct(`${s(this,d)}${v}`,B.name,"main-account__product");r.appendChild(U),r.appendChild(A),g.appendChild(r),O!==p.length-1&&g.appendChild(document.createTextNode(" "))}}),f.appendChild(g),l.appendChild(f);const L=this.htmlBuilder.createBlock("main-account__orders-cell");L.textContent=`${q}₽`,l.appendChild(L);const k=this.htmlBuilder.createBlock("main-account__orders-cell");k.textContent=I,l.appendChild(k);const C=this.htmlBuilder.createBlock("main-account__orders-cell"),E=this.htmlBuilder.createButton("Отмена","main-account__cancel");E.setAttribute("data-order-id",JSON.stringify(p)),C.appendChild(E),l.appendChild(C),n.appendChild(l)}),this.profileListElement.innerHTML="",this.profileListElement.appendChild(n)}}canselOrder(){document.querySelectorAll(".main-account__cancel").forEach((e,n)=>{e.addEventListener("click",()=>{const i=JSON.parse(localStorage.getItem("orders"));i.splice(n,1),console.log(i),localStorage.setItem("orders",JSON.stringify(i)),location.reload()})})}}d=new WeakMap,u=new WeakSet,b=function(t){const e=t.replace(/[^\d+]/g,"");return e.startsWith("+")?e.length===12&&/^\+7\d{10}$/.test(e):/^[78]/.test(e)?e.length===11&&/^[78]\d{10}$/.test(e):e.length===10&&/^\d{10}$/.test(e)};var h,a;class x{constructor(){c(this,h,{loginBlock:"[data-account-login-block]",inputLogin:"[data-account-login-input]",buttonLogin:"[data-account-login-button]",listBuy:"[data-account-list]",profileBlock:"[data-account-profile-block]",profileList:"[data-account-profile-list]",logoutButton:"[data-accaunt-profile-logout]",notorder:"[data-accaunt-profile-notorder]"});c(this,a);this.helpers=new N,this.view=new M(s(this,h)),this.init()}async init(){w(this,a,await this.helpers.getData()),this.addEventListenerToLogin(),this.view.hideUserLogin(),this.view.generateOrder(s(this,a)),this.view.logout(),this.view.canselOrder(),this.helpers.getCountBasket()}addEventListenerToLogin(){this.view.buttonLoginElement.addEventListener("click",()=>{this.view.loginUser()}),this.view.inputLoginElement.addEventListener("keypress",t=>{t.key==="Enter"&&this.view.loginUser()})}}h=new WeakMap,a=new WeakMap;new P;new T;new x;new J;new $;
