var E=i=>{throw TypeError(i)};var v=(i,t,e)=>t.has(i)||E("Cannot "+e);var o=(i,t,e)=>(v(i,t,"read from private field"),e?e.call(i):t.get(i)),p=(i,t,e)=>t.has(i)?E("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(i):t.set(i,e),I=(i,t,e,r)=>(v(i,t,"write to private field"),r?r.call(i,e):t.set(i,e),e);import{a as f,H as O,S as x,M as A,b as T}from"./SwitchPageController-ACxN1OJe.js";import{C as q}from"./CityController-DSj6KMa1.js";class N{constructor(t){this.notPurchasesElement=document.querySelector(t.notPurchases),this.productsElement=document.querySelector(t.products),this.productListElement=document.querySelector(t.productList),this.totalPriceElement=document.querySelector(t.totalPrice),this.countProductElement=document.querySelector(t.countProduct),this.createOrderElement=document.querySelector(t.createOrder),this.clearAllButtonElement=document.querySelector(t.clearAll),this.htmlBuilder=new f}hidePurchases(t){t.length?(this.notPurchasesElement.style.display="none",this.clearAllButtonElement.style.display="block"):(this.productsElement.style.display="none",this.clearAllButtonElement.style.display="none")}getTotalPrice(t,e){this.totalPriceElement.textContent=this.totalPrice(t,e)+" ₽"}totalPrice(t,e){let r=0;const a=document.querySelectorAll(".cart-items__counter");return document.querySelectorAll(".cart-items__item").forEach((u,P)=>{const l=e[P],h=t.find(s=>s.id===l);if(h){const s=parseInt(a[P].textContent);r+=h.price*s}}),r}updateTotalPrice(t,e){this.getTotalPrice(t,e)}getPrice(t){const e=document.querySelector(".cart-items__counter");return t*e.textContent+" ₽"}getCountProducts(){this.countProductElement.textContent=this.countProduct()}countProduct(){const t=document.querySelectorAll(".cart-items__counter");let e=0;return t.forEach(r=>{e=e+parseInt(r.textContent)}),e}deleteProductFromStorage(t){let e=JSON.parse(localStorage.getItem("buy"));e=e.filter(r=>r!=t),localStorage.setItem("buy",JSON.stringify(e)),location.reload()}createOrder(t,e){this.createOrderElement.addEventListener("click",()=>{if(localStorage.getItem("login")){let r=localStorage.getItem("orders");const a=[e,this.totalPrice(t,e),this.countProduct()];if(r){const d=JSON.parse(r);d.push(a),localStorage.setItem("orders",JSON.stringify(d))}else localStorage.setItem("orders",JSON.stringify([a]));alert("Ваш заказ вы можете увидеть у себя в аккаунте!"),localStorage.setItem("buy",JSON.stringify([])),console.log(this.productListElement),location.reload()}else alert("Сначало авторизуйтесь, чтобы оформить заказ!")})}clearAll(){this.clearAllButtonElement.addEventListener("click",()=>{localStorage.setItem("buy",JSON.stringify([])),location.reload()})}}var B,_,c,n;class J{constructor(){p(this,B," /TechnoPort/pages/product.html?id=");p(this,_,{notPurchases:"[data-basket-not-purchases]",products:"[data-busket-products]",productList:"[data-basket-product-list]",totalPrice:"[data-basket-totalPrice]",countProduct:"[data-basket-count]",createOrder:"[data-basket-createOrder]",clearAll:"[data-basket-clearAll]"});p(this,c,JSON.parse(localStorage.getItem("buy")));p(this,n);this.helpers=new O,this.view=new N(o(this,_)),this.htmlBuilder=new f,this.init()}async init(){I(this,n,await this.helpers.getData()),this.view.hidePurchases(o(this,c)),this.getProductsInBusket(),this.view.getTotalPrice(o(this,n),o(this,c)),this.view.getCountProducts(),this.view.createOrder(o(this,n),o(this,c)),this.view.clearAll(),this.helpers.buttonStopPropagation("cart-items__button"),this.helpers.addEventListenerToFavoritesButton("cart-items__buttons","cart-items__button"),this.helpers.getCountBasket()}getProductsInBusket(){o(this,c).forEach(t=>{const e=o(this,n).find(r=>r.id===t);this.view.productListElement.appendChild(this.createProductInBusket(e,t))})}createProductInBusket(t,e){const r=this.htmlBuilder.createListItem("cart-items__item"),a=this.htmlBuilder.createBlock("cart-items__info"),d=this.htmlBuilder.createImage(t.mainImage,"cart-items__image"),u=this.htmlBuilder.createBlock("cart-items__text"),P=this.htmlBuilder.createNameLinkProduct(`${o(this,B)}${e}`,t.name,"cart-items__title"),l=this.htmlBuilder.createBlock("cart-items__count"),h=this.htmlBuilder.createButton("-","cart-items__mines"),s=this.htmlBuilder.createText("p","1","cart-items__counter"),b=this.htmlBuilder.createButton("+","cart-items__add"),w=this.htmlBuilder.createBlock("cart-items__mainPrice"),L=this.htmlBuilder.createText("span",`${t.price} ₽ / шт`),C=this.htmlBuilder.createBlock("cart-items__price"),S=this.htmlBuilder.createPrice(t.price,"cart-items__cost"),g=this.htmlBuilder.createBlock("cart-items__buttons"),k=this.htmlBuilder.createButtonFavorit("/TechnoPort/images/header/heart.svg"),y=this.htmlBuilder.createButtonWithImage("/TechnoPort/images/basket/Trash.png","cart-items__button");return y.addEventListener("click",()=>{this.view.deleteProductFromStorage(e)}),b.addEventListener("click",()=>{const m=parseInt(s.textContent);m>9||(s.textContent=m+1,this.view.getTotalPrice(o(this,n),o(this,c)),S.textContent=this.view.getPrice(t.price),this.view.getCountProducts())}),h.addEventListener("click",()=>{const m=parseInt(s.textContent);if(m<2){this.view.deleteProductFromStorage(e);return}s.textContent=m-1,this.view.getTotalPrice(o(this,n),o(this,c)),S.textContent=this.view.getPrice(t.price),this.view.getCountProducts()}),k.classList.add("cart-items__button--favorit"),k.classList.add("cart-items__button"),y.classList.add("cart-items__button--delete"),g.setAttribute("data-delete-id",e),g.appendChild(k),g.appendChild(y),w.appendChild(L),l.appendChild(h),l.appendChild(s),l.appendChild(b),u.appendChild(P),u.appendChild(l),u.appendChild(w),a.appendChild(d),a.appendChild(u),C.appendChild(S),C.appendChild(g),r.appendChild(a),r.appendChild(C),r}}B=new WeakMap,_=new WeakMap,c=new WeakMap,n=new WeakMap;new J;new x;new A;new q;new T;
